import pytest\nimport os\nimport pathlib\n\nfrom unittest.mock import patch, ANY, mock_open\n\nfrom gatox.workflow_parser.workflow_parser import WorkflowParser\nfrom gatox.models.workflow import Workflow\nfrom gatox.workflow_parser.utility import check_sus\n\nTEST_WF = """\nname: 'Test WF'\n\non:\n  pull_request_target:\n  workflow_dispatch:\n\njobs:\n  test:\n    runs-on: ['self-hosted']\n    steps:\n\n    - name: Execution\n      run: |\n          echo 'Hello World and bad stuff!'\n"""\n\nTEST_WF2 = """\nname: 'Test WF2'\n\non:\n  pull_request_target:\n\njobs:\n  test:\n    runs-on: 'ubuntu-latest'\n    steps:\n    - name: Execution\n      uses: actions/checkout@v4\n      with:\n        ref: ${{ github.event.pull_request.head.ref }}\n"""\n\nTEST_WF3 = """\nname: Update Snapshots\non:\n  issue_comment:\n    types: [created]\njobs:\n  updatesnapshots:\n    if: ${{ github.event.issue.pull_request && github.event.comment.body == '/update-snapshots'}}\n    timeout-minutes: 20\n    runs-on: macos-latest\n    steps:\n      - uses: actions/checkout@v3\n        with:\n          fetch-depth: 0\n          token: ${{ secrets.GITHUB_TOKEN }}\n      - name: Get SHA and branch name\n        id: get-branch-and-sha\n        run: |\n          sha_and_branch=$(\n            curl \n              -H 'authorization: Bearer ${{ secrets.GITHUB_TOKEN }}' \n              https://api.github.com/repos/${{ github.repository }}/pulls/${{ github.event.issue.number }} \n            | jq -r '.head.sha," ",.head.ref');\n          echo 'sha=$(echo $sha_and_branch | cut -d " " -f 1)' >> $GITHUB_OUTPUT\n          echo 'branch=$(echo $sha_and_branch | cut -d " " -f 2)' >> $GITHUB_OUTPUT\n      - name: Fetch Branch\n        run: git fetch\n      - name: Checkout Branch\n        run: git checkout ${{ steps.get-branch-and-sha.outputs.branch }}\n      - uses: actions/setup-node@v3\n        with:\n          node-version: '19'\n      - name: Install dependencies\n        run: yarn\n      - name: Install Playwright browsers\n        run: npx playwright install --with-deps chromium\n      - name: Update snapshots\n        env:\n          VITE_TENDERLY_ACCESS_KEY: ${{ secrets.VITE_TENDERLY_ACCESS_KEY }}\n          VITE_CHAIN_RPC_URL: ${{ secrets.VITE_CHAIN_RPC_URL }}\n          CI: true\n        run: npx playwright test --update-snapshots --reporter=list\n      - uses: stefanzweifel/git-auto-commit-action@v4\n        with:\n          commit_message: '[CI] Update Snapshots'\n"""\n\nTEST_WF4 = """\nname: Benchmarks\non:\n  issue_comment:\n    types: [created]\njobs:\n  check-permission:\n    if: github.event.issue.pull_request && startsWith(github.event.comment.body, '/bench')\n    runs-on: ubuntu-latest\n    steps:\n    - name: Check permission\n      uses: actions/github-script@v6\n      with:\n        result-encoding: string\n        script: |\n          const response = await github.rest.repos.getCollaboratorPermissionLevel({\n            owner: context.repo.owner,\n            repo: context.repo.repo,\n            username: context.actor\n          });\n\n          const actorPermissionLevel = response.data.permission;\n          console.log(actorPermissionLevel);\n\n          // <- lower higher ->\n          // ["none", "read", "write", "admin"]\n          if (!(actorPermissionLevel == "admin" || actorPermissionLevel == "write")) {\n            core.setFailed('Permission denied.');\n          }\n\n  benchmarks:\n    # run only when PR comments start with '/bench'.\n    if: github.event.issue.pull_request && startsWith(github.event.comment.body, '/bench')\n    needs: check-permission\n    runs-on: [self-hosted, Linux, X64]\n    steps:\n    - name: Validate and set inputs\n      id: bench-input\n      uses: actions/github-script@v6\n      with:\n        result-encoding: string\n        script: |\n          const command = `${{ github.event.comment.body }}`.split(' ');\n          console.log(command);\n\n          // command should be '/bench chain_name pallets'\n          if (command.length != 3) {\n            core.setFailed('Invalid input. It should be \'/bench [chain_name] [pallets]\'');\n          }\n\n          core.setOutput('chain', command[1]);\n          core.setOutput('pallets', command[2]);\n\n    - name: Free disk space\n      run: |\n        sudo rm -rf /usr/share/dotnet\n        sudo rm -rf /usr/local/lib/android\n        sudo rm -rf /opt/ghc\n        sudo rm -rf \